---
export interface Props {
  title: string;
  image?: {
    src: string;
    alt: string;
  };
  href?: string;
  className?: string;
  imageLayout?: 'top' | 'background';
}

const { title, image, href, className = "", imageLayout = 'top' } = Astro.props;
const base = import.meta.env.BASE_URL;

// Prepend base to relative URLs (starting with /)
const finalHref = href && href.startsWith('/') && !href.startsWith('//') ? `${base}${href.slice(1)}` : href;
const finalImageSrc = image?.src && image.src.startsWith('/') && !image.src.startsWith('//') ? `${base}${image.src.slice(1)}` : image?.src;

const Element = href ? "a" : "div";
---

<Element
  href={finalHref}
  aria-label={href ? title : undefined}
  class:list={[
    'card group overflow-hidden',
    { 'relative': imageLayout === 'background' },
    className
  ]}
>
  {image && finalImageSrc && (
    <div class:list={[
      'overflow-hidden',
      { 'absolute inset-0': imageLayout === 'background' }
    ]}>
      <img
        src={finalImageSrc}
        alt={image.alt}
        class:list={[
          "w-full object-cover object-center transition-transform duration-300 group-hover:scale-105",
          { 'h-full': imageLayout === 'background', 'h-auto': imageLayout === 'top' }
        ]}
      />
    </div>
  )}

  <div class:list={[
    'p-5',
    { 'relative': imageLayout === 'background' }
  ]}>
    <h3 class="mb-2 text-xl font-bold">{title}</h3>
    <div class="text-gray-700">
      <slot />
    </div>
  </div>
</Element>
